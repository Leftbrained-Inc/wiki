# :arrow_right: Система команд - Команды пересылки

Система команд МП-580 насчитывает более **240 команд**. Многие из них повторяют свое мнемоническое название, отличаясь друг от друга только операндом.

> :bulb: Например, команда MOV повторяется 64 раза, указывая при помощи новых операндов разные места пересылки данных.

Описание каждой команды содержит её символическое обозначение по правилам языка ассемблера, символическое и словесное описание выполняемой операции, а также информацию об особенностях выполнения команды:

- число машинных циклов
- число машинных тактов
- признаки, изменяемые в процессе данной команды

# Команды пересылки

Они чаще других встречаются при составлении программ и поэтому на них следует обратить особое внимание. Каждая пересылка данных всегда связана с местом, куда они пересылаются, а именно с приёмником данных и тем местом, откуда эти данные поступают — источником данных.

> :bulb: При написании операнда  условились сначала указывать приёмник, а затем источник
> 
>> Наименование приёмника и источника разделяют запятой.


Они не формируют флаги, выполняются за один машинный цикл и кодируются одним байтом. Если источник или приёмник — это ячейка памяти, то её адрес помещается в регистровой паре HL.

## `MOV`

Данная команда пересылок позволяет обменивать данные между РОН и памятью. 

Синтаксис команды выглядит вот так:

```assembly
MOV R1, R2
MOV R, M
MOV M, R
```

При обмене данными между внутренними регистрами A-L команда MOV повторяется ****49 раз****, указывая в своём операнде различные сочетания регистров (A-B, A-C, A-E, A-L, B-A и так далее). Число машинных циклов и тактов зависит от того, выполняется ли обращение к ячейке памяти. 

> Циклов: **1/2**, тактов: **5/7**


Например, команда `MOV A, B` позволяет переслать 8-битные данные из регистра B в аккумулятор A, команда `MOV H, E` — из регистра E в регистр H, то есть пересылка осуществляется из R1 в R2. При этом используется регистровый способ адресации и команда является однобайтовой, в которой:

| 0 | 1 | Код R1 | Код R2 |
| --- | --- | --- | --- |
|  |  | Коды регистров |  |

## `MVI`

Предназначена для размещения в каком-либо регистре РОН МП произвольного числа K. Последняя буква мнемоники команды I указывает на то, что в команде участвуют непосредственные данные. 

Команда `MVI R, K` является двухбайтовой — в первом байте указывается код команды и код регистра приёмника, во втором же байте указывается непосредственно число K.

| MVI B, 12H — пример команды |
| --- |
| Процесс: Число 12, записанное в 16-ричном формате записывается в регистр B. Режим адресации — непосредственный. Команда состоит из двух байт, выполняется за два машинных цикла и имеет формат:

00'DDD'110 |
| H здесь означает, что число 12 — в 16-ричном формате |

### `MVI M, K`

Данная команда позволяет записвать в ячейку памяти восьмиразрядное число K. При этом адрес ячейки памяти находится в регистровой паре HL. 

| В ячейке памяти M с адресом 0FF0H записать число 17H. |
| --- |
| Необходимо выполнить следующие команды:

MVI H, 0FH
MVI L, F0H
MVI M, 17H |
| Циклов: 2 / 3, тактов: 7 / 10 |

```assembly
MOV ; Переместить из одной ячейки памяти в другую
MVI ; Запись в регситр
LXI ; Запись шестнадцатиразрядное число в регистровую пару
LDA ; Команда загрузки аккумулятора 8-разрядным операндом
```

## `LXI`

### `LXI P, K`

Позволяет загружать 16-разрядное, а не 8-разрядное число K, причём запись осуществляется в регистровую пару P, а не в регистр R. Команда `LXI P, K` — трехбайтовая

Операнд P обозначает одну из регистровых пар КР580 BC, DE или HL, причем последние в этом случае обозначаются как: `B`, `D`, `H`

| По команде LXI H, FF00H, в регистровую пару HL загружается число FF00H | LXI H, 8203H |
| --- | --- |
| Выполняется за три цикла и имеет формат: 00'RR'0001 | Байт 1 — 0011’1010; 2H — код операции
Байт 2 — 0000’0011; 03H — младшая часть 16-разрядного операнда
Байт 3 — 1000’0010; 82H — старшая часть 16-разрядного операнда |
| RR — код регистровой пары | Циклов: 3, тактов: 10 |

## `LDA`

### `LDA ADR`

Команда загрузки аккумулятора 8-разрядным операндом из ячейки памяти, адрес которой указан во втором и третьем байтах команды. Режим адресации — прямой. Команда выполняется за четыре машинных цикла и имеет код:

`0011'1010` или `3AH`

Например, команда `LDA 8203H`; A → M(8203H) примет вид:

- Байт 1 — `0011’1010`; 3AH — код операции
- Байт 2 — `0000’0011`; 03H — младшая часть адреса
- Байт 3 — `1000’0010`; 82H — старшая часть адреса

> Циклов: **4**, тактов: **13**

## `STA`

### `STA ADR`

Команда позволяет сохранять содержимое аккумулятора в ячейке памяти, адрес которой указан во втором и третьем байте команды. Режим адресации — прямой. Команда выполняется за четыре машинных цикла и имеет код:

$$
0011'0010\ или\ 32H
$$

> Циклов: **4**, тактов: **13**

## `LDAX P` и `STAX P`

Команды выполняют те же операции, что и команды `LDA` и `STA`, то есть пересылают содержимое ячейки памяти M, в аккумулятор и обратно. Отличие этих команд заключается в том, что адрес ячейки находится в 2 и 3 байтах самой команды, а в `LDAX` и `STAX` адрес ячейки хранится в регистровой паре P. Причем регистровой парой может быть только пара BC и DE.

В регистровой паре HL размещать такой адрес нельзя. Команды `LDAX` и `STAX` — однобайтовые и эти команды в основном используются в том случае, когда по условию выполнения программы адрес ячейки памяти M по тем или иным причинам уже находится в регистровой паре BC или DE.

> Циклов: **2**, тактов: **7**

## `XCHG` и `SPHL`

### `XCHG ADR`

Содержимое регистров H и L взаимно обменять с содержимым регистров D и E.

> Циклов: **1**, тактов: **4**

### `SPHL ADR`

Содержимое регистров H и L занести в регистр SP

> Циклов: **1**, тактов: **5**

## `LHLD` и `SHLD`

### `LHLD ADR`

В регистр L передается содержимое первой ячейки памяти, адрес которой записан во втором и третьем байте команды. В регистр H передается содержимое второй ячейки памяти, адрес которой на единицу больше адреса первой ячейки.

> Циклов: **5**, тактов: **16**

### `SHLD ADR`

Обратная команде LHLD, когда загружаются две соседние ячейки памяти содержимым регистров H и L.

> Циклов: **5**, тактов: **16**

# Команды обращения к стеку

## PUSH RP

Запись в стек. Содержимое старшего регистра регистровой пары RP’’ перемещается в ячейку памяти, адрес которой на единицу меньше исходного содержимого регистра SP. Содержимое младшего регистра регистровой пары RP’’ помещается в ячейку памяти, адрес которой меньше исходного содержимого SP на 2. Содержимое самого регистра уменьшается на 2.

> Циклов: **3**, тактов: **11**

## XTHL

Обмен содержимым регистровой пары H с вершиной стека. Регистр L обменивается содержимым с ячейкой памяти, адрес которой определяется содержимым регистра SP. Регистр H обменивается содержимым с ячейкой памяти, адрес которой на единицу больше содержимого регистра SP.

> Циклов: **6**, тактов: **18**

## Команды ввода-вывода

Команды ВВ позволяют переместить содержимое аккумулятора в порт вывода, и наоборот, из порта ввести данные в аккумулятор.

МП КР580 способен адресовать 256 портов ввода и 256 портов вывода, поэтому адреса портов могут принимать значения от 00H до FFH.

`IN` — ввод из порта в аккумулятор. Команда состоит из двух байт — кода операции и номера порта

`IN 02H; A → Port 02H`. Режим адресации — **прямой**.

> Циклов: 3, тактов: 10

`OUT` — вывод из аккумулятора в порт

`OUT 04H; Port 04H → A`

> Циклов: 3, тактов: 10