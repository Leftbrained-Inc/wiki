# :link: Методы адресации

Системой команд называют перечень инструкций команд, которые может выполнить данный микропроцессор. 

> В системе команд МП КР580 имеются **однобайтовые, двухбайтовые и трёхбайтовые** команды. Формат команды и тип адресации задаются в команде неявно кодом операции. Адрес команды определяется адресом её **первого байта**.

**Формат команды** показывает, из каких составных частей она состоит, а также определяет функциональное назначение этих частей. Говоря о формате команд, прежде всего, обращают внимание на длину команды.

**Длина команды** может быть в один, два или три байта. Формат команд во многом зависит от способа адресации, используемого в команде.

> :book: **Адресация** — способ указания нахождения операндов, над которыми данная команда совершает те или иные действия.

Систему команд рассматриваемого микропроцессора **K580BM80A** можно классифицировать по трём основным признакам:

1. **Длине команды** (одно-, двух- и трехбайтовые);
2. **Функциональному назначению** (передачи, обработки данных, команды управления);
3. **Архитектурным признакам** (операции с регистрами, памятью и портами).

> :warning: Современные тенденции развития ЭВМ показывают, что фирмы-разработчики микропроцессоров стараются создавать дополнительные наборы команд на основе уже существующих, сохраняя программную преемственность с предыдущими поколениями процессоров.

Такне ресурсоёмкие задачи, как расчёт трёхмерной графики, компрессия/декомпрессия аудио-видеоданных и другие, используют дополнительные наборы команд (3DNow, MMX, SSE, и др.), оптимизированные под соответствующие приложения.

## Методы адресации

Для взаимодействия различных модулей в микроЭВМ должны быть средства идентификации ячеек внешней памяти, ячеек внутренней памяти, регистров МП и регистров устройств ввода/вывода. Поэтому каждой из запоминающих ячеек присваивается адрес, то есть однозначная комбинация бит. 

Количество бит определяет число идентифицируемых ячеек. Обычно ЭВМ имеет различные адресные пространства памяти и регистров МП, а иногда — отдельные адресные пространства регистров, устройств ввода/вывода и внутренней памяти.

Кроме того, память хранит как данные, так и команды. С другой стороны, при разработке микропроцессоров стараются использовать коды операций минимальной длины, что приводит к возникновению проблемы идентификации данных из-за короткого машинного слова. Поэтому для ЭВМ разработано множество способов обращения к памяти, называемых режимами адресации.

> :book: **Режим адресации памяти** — процедура или схема преобразования адресной информации об операнде в его исполнительный адрес.

При написании команд очень важно правильно выбрать способ адресации данных, который требовал бы **наименьший объем памяти** для размещения данных и наименьшее время исполнения команды.

В микропроцессоре *КР580BM80А* используется **пять методов** адресации:

1. Прямой
2. Регистровый
3. Косвенный
4. Непосредственный
5. Неявный

## Подробнее о каждом методе

1. **Прямая адресация**
    
    В поле самой команды содержится полный 16-битный адрес операнда в памяти. С помощью прямой адресации можно обращаться к любой ячейке в адресном пространстве, в том числе этим адресом может быть номер порта устройства ввода/вывода. Он указывается во втором (младшая часть адреса) и в третьем (старшая часть) байтах команды. Это наиболее простая, но наименее экономичная адресация.

    
1. **Регистровая адресация***
    
    Вслед за кодом операции указывают код регистра, где хранятся данные. Этот код занимает три разряда для каждого регистра, поэтому команды получаются однобайтовые и выполняются довольно быстро.
    
2. **Косвенная адресация**
        
    При косвенной адресации указывают код регистров, в которых находится адрес ячейки памяти, содержащий данные. Косвенный способ адресации позволяет компактно адресовать пространство памяти при помощи коротких однобайтовых команд. В этом режиме в поле команды содержится указание на регистровую пару, содержащую адрес операнда (данных).
        
    `MOV A, М` - пересылка в А из ячейки памяти, на которую указывает HL;
        
    `LDAX B` - загрузка А из ячейки памяти, на которую указывает пара ВС.
        
    > Косвенная адресация широко применяется при обращении к структурам данных типа **массивов**.
    
1. **Непосредственная адресация**
        
    При непосредственной адресации в качестве операнда используется значение, содержащееся в самой команде. Этот режим адресации позволяет компактно кодировать команды, но требует большего объема памяти для хранения данных. Кроме того, при использовании этого режима нельзя работать со значениями, которые не могут быть выражены в виде константы в команде.
        
    `MVI A, 10H` - загрузка константы 10H в регистр А;
        
    `ADI 20H` - прибавление константы 20H к содержимому регистра А.
        
    > Непосредственная адресация применяется для передачи константных значений в команды, а также для выполнения арифметических и логических операций с ними.
        
1. **Неявная адресация**
        
    Адрес операнда не указывается в явном виде, а определяется кодом операции. Обычно один из операндов должен находиться во внутреннем регистре микропроцессора, чаще всего в регистре А, называемом аккамулятором.
        
    Поэтому нет необходимости дополнительно сообщать его адрес.
        
    `ADD B`; A ← A + B, аккумулятор не задается в явном виде
        
    Команды с неявной адресацией получаются более короткими, что сокращает их написание и выполнение. 
        
    > Неявный способ адресации **часто встречается** в командах *МП КР580*, который устроен так, что все логические и арифметические операции выполняются только через аккумулятор, когда один из операндов должен находиться в аккумуляторе еще до выполнения команды.

Если отсутствуют прерывания и команды передачи управления, то выборка и исполнение команд осуществляются последовательно из ячеек памяти, адреса которых возрастают (инкрементируются).

**Команды передачи управления** могут задавать адрес следующей команды одним из трех способов:

- **Прямая адресация**. Команда передачи управления содержит адрес команды, которая должна выполняться следующей
- **Косвенно-регистровая адресация**. Команда передачи управления задает регистровую пару, содержимое которой представляет собой адрес следующей команды (старший полуадрес расположен в первом, а младший — во втором регистре пары)
- **Адресация по номеру подпрограммы**. Команда RST является специальной однобайтовой командой перехода к фиксированной подпрограмме, используемой обычно для реализации прерываний. Команда RST имеет 3-битное поле, в котором содержится код, соответствующий одному из 8 возможных начальных адресов подпрограммы.

---

В качестве разновидности косвенно-регистровой адресации можно рассматривать автоинкрементную-автодекрементную адресацию через указатель стека, при которой адреса ячеек памяти, где хранятся 16-битные данные или адрес возврата из подпрограммы, формируются в регистре — указателе стека.

Из определения различных способов адресации видно, что длина команды зависит именно от способа применяемой в ней адресации. Если адресная информация в команде представляется в сжатой короткой форме, то длина команды будет один байт. 

Таким образом, однобайтовыми командами являются команды, использующие регистровую, косвенно-регистровую адресацию и адресацию по номеру подпрограммы.

Во втором байте двухбайтовых команд содержатся 8-битные данные или номер порта ввода-вывода. Во втором и третьем байтах трехбайтовых команд содержится адрес операнда в памяти.

> Код выполняемой операции всегда содержится в первом байте команды, причем отдельные биты этого кода могут содержать дополнительную (в первую очередь адресну) информацию.

- **Биты 3, 4, 5** — код регистра-приемника данных, код анализируемого условия (нулевое или единичное значение какого-либо признака) в командах условной передачи или номер фиксированной подпрограммы (от 0 до 7) в команде перехода к фиксированной подпрограмме
- **Биты 4 и 5** — код регистровой пары или 16-битного регистра в командах с участием регистровых пар
- **Биты 0, 1, 2** — код регистра-источника данных

Команды **МП КР580** могут быть **1/2/3 байтовыми**. Однобайтовая команда представлена байтом и занимает одну ячейку памяти:

- **7 и 6 биты** — код операции
- **3, 4 и 5 биты** — адрес регистра-получателя
- **0, 1 и 2 биты** — адреса регистра-источника